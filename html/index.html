<html>
<link rel=stylesheet href=lyrics.css>
  <title>"Bucket Brigade" Audio Demo</title>
<h1>"Bucket Brigade" Audio Demo</h1>

<div id="lyrics">
  <div id="lyricHolder"></div>
  <a id=lyricButton>Tap on Downbeat</a>
  <div id="lyricDbg"></div>
</div>

<h3>Settings:</h3>
  Input device:
  <select id=inSelect disabled=true>
    <option>Loading...</option>
  </select>
  <div id=clickParams>(Clicks BPM if selected: <input type=text id=clickBPM value=60>)</div>
<br>
  Output device:
  <select id=outSelect disabled=true>
    <option>Loading...</option>
  </select>
<br>
  Audio offset (seconds):
  <input type=text id=audioOffset value="0">
<br>
  Client latency compensation (ms):
  <!--<input id=latencyCompensation type=range min=0 max=500 value=50>-->
  <input type=text id=latencyCompensationText value="0">
  <span id=latencyCompensationLabel></span>
  <button id=latencyCompensationApply>Set</button>
<br>
<h3>Controls:</h3>
  <button id=startButton disabled=true>Start</button>
  <button id=stopButton disabled=true>Stop</button>
<br>
  <button id=estimateLatencyButton disabled=true>Run latency estimation</button>
<br>

<button type="button" data-otherlabel="Close debug settings" class="collapse">Open debug settings</button>
<div style="display:none">
    Loopback mode:
    <select id=loopbackMode>
      <option value=none selected>None (default)</option>
      <option value=worklet>Inside worklet process()</option>
      <option value=main>In main app thread</option>
      <option value=server>Server-side</option>
    </select>
  <br>
    Server path:
    <input type=text id=serverPath value="/api/">
  <br>
    Console log level:
    <select id=logLevel></select>
</div>
<h3>Debug info:</h3>
  Sample rate:
  <input type=text id=sampleRate value="(not available yet)" disabled>
<br>
  Input / output peak absolute amplitude:
  <input type=text id=peakIn value="(not available yet)" disabled>
  <input type=text id=peakOut value="(not available yet)" disabled>
<br>
  This client total time consumed (s):
  <input type=text id=clientTotalTime value="(not available yet)" disabled>
<br>
  This client read slippage (s):
  <input type=text id=clientReadSlippage value="(not available yet)" disabled>
<br>
<br>
  Server audio buffer visualization:
  <ul>
    <li>Black bars: server's clearing window (leading bar represents "now", trailing bar is mostly meaningless except for debugging)</li>
    <li>Green bars: This client's reading window (source of our audio during previous network request)</li>
    <li>Blue bars: This client's writing window (where our audio was written during previous network request)
    <li>The buffer is circular (it wraps around). Other clients' windows are not visible here.
  </ul>
  <canvas id=audioGraph style="width:100%" height=100>
<br>

<div id="secretCrap" style="display:none">
  <!--<span id=hamiltonAudioSpan><audio src="hamilton.mp3" preload=true></audio></span>-->
  <span id=outputAudioSpan><audio id=outputAudio></audio></span>
</div>

<script type="module" src="./app.js"></script>
<script type="module" src="./lyrics.js"></script>
</html>
